<html>
<meta name="viewport" content="width=device-width">

<style>
body{background:white;text-align:center;}
textarea{
    width:90%;
    height:25%;
    margin:10px;
}
button{
    margin:10px;
}

</style>
<br><br>Password
<input id="pass"><br>
original <textarea id="o"></textarea>
<br>
<button onclick="codif()">Codificar</button>
<button onclick="decodif()">Decodificar</button>
<button onclick="simplify()">Simplify</button>
<br>
Codificado <textarea id="c"></textarea>
<button onclick="c.select();document.execCommand('copy');alert('copied to Clipboard')">Copy</button>
<button onclick="dwnl()">Download File</button>
<script>

function dwnl(){
var n=prompt("File Name?","MyFile")
if(n===null) return;
var e=prompt("Extension?","txt")
if(e===null) return;
download(o.value,n+"."+e);
}
function codif(){
  cod(pass.value,o.value,function(res){
      c.value=res;
      });
}

function decodif(){
      decod(pass.value,c.value,function(res){
          o.value=res;
          });
}

decod = function(clv, r,callback) {
    var s = "";
    for (var i = 0; i < r.length; i++) {
        i--;
        for (var ii = 0; ii < clv.length; ii++) {
            i++;
            var n1 = r.charCodeAt(i);
            var n = n1 - clv.charCodeAt(ii);
            s += String.fromCharCode(n);
            if (i === r.length - 1) {
                ii = clv.length;
                i = r.length;
            }
        }
    }
    if(callback!=undefined) callback(s);
    return s;
}

function cod(clv, r,callback) {
    var s = "";
    for (var i = 0; i < r.length; i++) {
        var n = 0;
        i--;
        for (var ii = 0; ii < clv.length; ii++) {
            i++;
            n = r.charCodeAt(i);
            n = n + clv.charCodeAt(ii);
            s += String.fromCharCode(n);
            if (i === r.length - 1) {
                ii = clv.length;
                i = r.length;
            }
        }
    }
    if(callback!=undefined) callback(s);
    return s;
}
function simplify(tx){
    
    c.value=o.value.replace(/\n/g,"");


}

function download(filename, text) {
    var element = document.createElement('a');
    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    element.setAttribute('download', filename);

    element.style.display = 'none';
    document.body.appendChild(element);

    element.click();

    document.body.removeChild(element);
}

</script>

</html>
